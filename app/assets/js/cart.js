"use strict";(self.webpackChunkmarketplace_template_poc=self.webpackChunkmarketplace_template_poc||[]).push([[511],{3759:function(h,u,g){g.r(u);var l=g(4396);const p=function(){const i=e=>Object.keys(e).map(n=>e[n]).flat(),t=this;t.settings={},t.settings.container=document.querySelector("[data-cart]"),t.settings.lineItem="[data-lineitem]",t.settings.itemIdAttr="data-lineitem-id",t.settings.sellerIdAttr="data-lineitem-sellerid",t.settings.sellerNameSelector="[data-lineitem-seller]",t.settings.unitPriceSelector="[data-lineitem-unitprice]",t.settings.quantityInputSelector="[data-lineitem-quantity]",t.settings.totalPriceSelector="[data-lineitem-totalprice]",t.settings.removeSelector="[data-lineitem-remove]",t.settings.errorFieldSelector="[data-lineitem-errors]",t.settings.total=document.querySelector("[data-total]"),t.settings.submit=document.querySelector("[data-cart-checkout]"),t.settings.empty=document.querySelector("[data-cart-empty]"),t.settings.summary=document.querySelector("[data-cart-summary]"),t.settings.loading=document.querySelector("[data-cart-loading]"),t.settings.promo=document.querySelector("[data-promo]"),t.settings.promoModal=document.querySelector("[data-promo-modal]"),t.settings.promoModalContent=document.querySelector("[data-promo-modal-content]"),t.settings.subTotalParent=document.querySelector("[data-subtotal-parent]"),t.settings.subTotal=document.querySelector("[data-subtotal]"),t.settings.promoParent=document.querySelector("[data-promo-parent]"),t.settings.promoValue=document.querySelector("[data-promo-value]"),t.settings.promoCodeButtonSelector="[data-apply-code]",t.settings.promoCodesPopupCloseSelector="[data-promoCodes-close]",t.settings.promoCodesCodeName=document.querySelector("[data-promo-code-name]"),t.settings.shippingParent=document.querySelector("[data-shipping-parent]"),t.settings.shipping=document.querySelector("[data-shipping]"),t.init=()=>{t.settings.container.addEventListener("click",s=>{if(s.target.matches(t.settings.removeSelector)){let a=s.target.closest(t.settings.lineItem).getAttribute(t.settings.itemIdAttr);t.removeItem(a)}});let e;const n=s=>{s.target.matches(t.settings.quantityInputSelector)&&(clearTimeout(e),t.settings.submit.disabled=!0,t.settings.loading.classList.remove("hidden"),e=setTimeout(()=>{let a=s.target.closest(t.settings.lineItem).getAttribute(t.settings.itemIdAttr);t.calculateItemTotalPrice(a,s.target.value)},400))};t.settings.container.addEventListener("input",s=>{n(s)});let o;document.addEventListener("cart-lineItems-changed",()=>{clearTimeout(o),o=setTimeout(()=>{t.updateTotal()},200)}),document.addEventListener("cart-changed",()=>{t.settings.submit.disabled=!1,t.settings.loading.classList.add("hidden")}),document.addEventListener("cart-changed",s=>{s.detail.total_quantity||(t.settings.container.remove(),t.settings.summary.remove(),t.settings.empty.classList.remove("hidden"))}),t.settings.promo.addEventListener("click",()=>{t.openPromos()}),document.addEventListener("click",s=>{s.target.matches(t.settings.promoCodesPopupCloseSelector)&&t.closePromos()}),document.addEventListener("click",s=>{s.target.matches(t.settings.promoCodeButtonSelector)&&t.applyCode(s)})},t.removeItem=e=>{t.settings.submit.disabled=!0,t.settings.loading.classList.remove("hidden"),(0,l.Z)("/api/line_items/delete",{method:"DELETE",body:JSON.stringify({id:e})}).then(n=>{if(n.valid){let o=t.settings.container.querySelector(`[${t.settings.itemIdAttr}="${e}"]`),s=o.getAttribute(t.settings.sellerIdAttr);o.remove(),t.settings.container.querySelectorAll(`${t.settings.lineItem}[${t.settings.sellerIdAttr}="${s}"]`).length===0&&t.settings.container.querySelector(`${t.settings.sellerNameSelector}[${t.settings.sellerIdAttr}="${s}"]`).remove(),document.dispatchEvent(new CustomEvent("cart-lineItems-changed"))}})},t.calculateItemTotalPrice=(e,n)=>{const o=t.settings.container.querySelector(`[${t.settings.itemIdAttr}="${e}"]`),s=o.querySelector(`${t.settings.quantityInputSelector}`),a=t.settings.container.querySelector(`${t.settings.errorFieldSelector}[${t.settings.itemIdAttr}="${e}"]`),r={show:()=>{s.classList.add("border-danger"),a.innerText=api.strings.quantityExceeded,t.settings.loading.classList.add("hidden"),t.settings.loading.classList.remove("card-overlay"),t.settings.summary.classList.add("text-danger")},hide:()=>{s.classList.remove("border-danger"),a.innerText="",t.settings.summary.classList.remove("text-danger")}},d=m=>{o.querySelector(t.settings.totalPriceSelector).innerText=m},c=()=>(0,l.Z)("/api/line_items/update",{method:"PUT",body:JSON.stringify({id:e,line_item:{quantity:n}})}).then(m=>{m.errors?r.show():(r.hide(),d(m.total_price),document.dispatchEvent(new CustomEvent("cart-lineItems-changed")))});n<=0||n>parseInt(s.getAttribute("max"))?r.show():(r.hide(),c())},t.updateTotal=()=>{(0,l.Z)("/api/cart/show",{method:"GET"}).then(e=>{e.subtotal&&e.total_promo_discount?(t.settings.subTotal.innerHTML=e.subtotal,t.settings.subTotalParent.classList.remove("hidden"),t.settings.promoValue.innerHTML="- "+e.total_promo_discount,t.settings.promoParent.classList.remove("hidden"),t.settings.promoCodesCodeName.innerHTML=e.code_name):(t.settings.subTotalParent.classList.add("hidden"),t.settings.promoParent.classList.add("hidden"),t.settings.promo.classList.remove("hidden")),e.total_shipping?(t.settings.shipping.innerHTML=e.total_shipping,t.settings.shippingParent.classList.remove("hidden")):t.settings.shippingParent.classList.add("hidden"),t.settings.total.innerText=e.total,document.dispatchEvent(new CustomEvent("cart-changed",{detail:e}))})},t.openPromos=()=>{t.settings.promoModal.classList.remove("hidden");let e=[];document.querySelectorAll("[data-lineItem-seller]").forEach(n=>{const o=n.getAttribute("data-lineItem-sellerId");e.push(o)}),fetch(`/codes/show.frame?sellerIds=${e.join(",")}`).then(n=>n.text()).then(n=>{t.settings.promoModalContent.innerHTML=n,document.querySelector("[data-codeForm]").addEventListener("submit",t.applyManualCode)})},t.closePromos=()=>{t.settings.promoModal.classList.add("hidden")},t.applyCode=e=>{const n=e.target.getAttribute("data-sellerId"),o=e.target.getAttribute("data-promoId"),s=e.target.getAttribute("data-code"),a={promoId:o,sellerId:n,code:s};(0,l.Z)("/api/cart/update_promo_code",{method:"PUT",body:JSON.stringify(a)}).then(r=>{var d;if(r.error){let c=r.error;return((d=r.orders)==null?void 0:d.errors)&&(c=i(r.orders.errors)),new api.flash("error",c),!1}t.settings.promoModal.classList.add("hidden"),t.settings.promo.classList.add("hidden"),document.dispatchEvent(new CustomEvent("cart-lineItems-changed"))})},t.applyManualCode=e=>{e.preventDefault();const n=e.target,o=new FormData(n),s=JSON.stringify(Object.fromEntries(o));(0,l.Z)("/api/cart/update_promo_code",{method:"PUT",body:s}).then(a=>{var r;if(a.error){let d=a.error;return((r=a.orders)==null?void 0:r.errors)&&(d=i(a.orders.errors)),new api.flash("error",d),!1}t.settings.promoModal.classList.add("hidden"),t.settings.promo.classList.add("hidden"),document.dispatchEvent(new CustomEvent("cart-lineItems-changed"))})},t.init()};api.cart=new p;const y=new function(){const i=this;i.settings={},i.settings.counters=document.querySelectorAll("[data-cart-counter]"),i.settings.lineItems=document.querySelectorAll("[data-lineitem]"),i.init=()=>{document.addEventListener("cart-changed",t=>{i.settings.counters.forEach(e=>{e.innerText=t.detail.total_quantity})})},i.init()},S=new function(){const i=this;i.settings={},i.settings.container=document,i.settings.addToWishlist="[data-lineItem-wishlist]",i.settings.endpoint="/api/relationships/create.json",i.settings.headerIcon=document.querySelector('[data-header-wishlist] [data-icon="heartFull"]'),i.init=()=>{i.settings.container.addEventListener("click",t=>{t.target.matches(i.settings.addToWishlist)&&(t.target.disabled=!0,t.target.innerText=api.strings.saving,i.moveToWishlist(t.target.dataset.itemId,t.target.dataset.lineitemId))}),i.settings.headerIcon.addEventListener("animationend",()=>{i.settings.headerIcon.classList.remove("wishlist-added")})},i.moveToWishlist=(t,e)=>{let n={name:"wishlist",l_id:api.profile.id.toString(),r_id:t};(0,l.Z)(i.settings.endpoint,{body:JSON.stringify(n)}).then(o=>{o.valid?(i.settings.headerIcon.classList.add("wishlist-added"),api.cart.removeItem(e),new api.flash("success",api.strings.addedToWishlist)):new api.flash("error",api.strings.cantAddToWishlist)})},i.init()}}}]);
